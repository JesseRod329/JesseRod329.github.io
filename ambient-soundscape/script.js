const playBtn = document.getElementById('playBtn'), stopBtn = document.getElementById('stopBtn'), moodSelect = document.getElementById('moodSelect'), volumeControl = document.getElementById('volumeControl'), complexityControl = document.getElementById('complexityControl'), canvas = document.getElementById('waveCanvas'), ctx = canvas.getContext('2d'); let synths = [], isPlaying = !1; canvas.width = canvas.offsetWidth * 2; canvas.height = 800; ctx.scale(2, 2); const moods = { calm: [{ freq: 220, wave: 'sine' }, { freq: 330, wave: 'sine' }], forest: [{ freq: 150, wave: 'triangle' }, { freq: 200, wave: 'sine' }, { freq: 300, wave: 'square' }], ocean: [{ freq: 80, wave: 'sine' }, { freq: 120, wave: 'triangle' }], rain: [{ freq: 400, wave: 'noise' }, { freq: 600, wave: 'noise' }], space: [{ freq: 100, wave: 'sine' }, { freq: 150, wave: 'sine' }, { freq: 200, wave: 'triangle' }] }; function startSoundscape() { if (isPlaying) return; isPlaying = !0; playBtn.disabled = !0; stopBtn.disabled = !1; const mood = moodSelect.value, complexity = parseInt(complexityControl.value), volume = parseFloat(volumeControl.value); const notes = moods[mood] || moods.calm; synths = notes.slice(0, complexity).map(note => { const synth = new Tone.Synth({ oscillator: { type: note.wave }, envelope: { attack: .5, decay: 1, sustain: .3, release: 2 } }).toDestination(); synth.volume.value = Tone.gainToDb(volume); return { synth, freq: note.freq } }); synths.forEach(({ synth, freq }, i) => { setTimeout(() => { synth.triggerAttack(freq); setInterval(() => { const newFreq = freq + Math.random() * 20 - 10; synth.frequency.rampTo(newFreq, 2) }, 3000 + i * 1000) }, i * 500) }); visualize() } function stopSoundscape() { isPlaying = !1; playBtn.disabled = !1; stopBtn.disabled = !0; synths.forEach(({ synth }) => synth.triggerRelease()); synths = [] } function visualize() { if (!isPlaying) return; const w = canvas.width / 2, h = canvas.height / 2; ctx.fillStyle = 'rgba(15,15,35,0.1)'; ctx.fillRect(0, 0, w, h); synths.forEach(({ synth }, i) => { const y = h / 2 + Math.sin(Date.now() / 1000 + i) * 50; const x = (Date.now() / 50 + i * 100) % w; ctx.fillStyle = `hsl(${i * 60},70%,60%)`; ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI * 2); ctx.fill() }); requestAnimationFrame(visualize) } playBtn.addEventListener('click', async () => { await Tone.start(); startSoundscape() }); stopBtn.addEventListener('click', stopSoundscape); volumeControl.addEventListener('input', e => { synths.forEach(({ synth }) => { synth.volume.value = Tone.gainToDb(parseFloat(e.target.value)) }) });
